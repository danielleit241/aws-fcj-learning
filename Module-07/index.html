<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Bản đồ chỉ đường Việt Nam</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  </head>
  <body>
    <h2>Chỉ đường trong Việt Nam</h2>
    <div id="map" style="height: 600px"></div>
    <div id="info"></div>

    <script>
      // Tạo bản đồ zoom mặc định tại VN
      const map = L.map("map").setView([16.047079, 108.20623], 6); // VN center

      // Tile từ OSM
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
      }).addTo(map);

      // Gọi API backend
      async function loadRoute() {
        const res = await fetch(
          "http://localhost:5000/api/route?origin=106.660172,10.762622&destination=105.834160,21.027763"
        );
        const data = await res.json();

        const route = data.routes[0];
        const coords = route.geometry.coordinates.map((c) => [c[1], c[0]]); // [lat,lng]

        // Vẽ polyline
        const polyline = L.polyline(coords, { color: "blue" }).addTo(map);
        map.fitBounds(polyline.getBounds());

        // Hiển thị km + thời gian
        const km = (route.distance / 1000).toFixed(2);
        const mins = (route.duration / 60).toFixed(1);

        document.getElementById(
          "info"
        ).innerHTML = `<b>Khoảng cách:</b> ${km} km<br><b>Thời gian:</b> ${mins} phút`;
      }

      loadRoute();
    </script>
  </body>
</html>
